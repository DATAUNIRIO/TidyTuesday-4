---
title: "Hotel Bookings"
author: "EE"
date: "2/13/2020"
output: html_document
---

## Possible options
Rank chart of European countries over time (count of number booked; could add gghighlight by largest and smallest seasonal variance)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(gghighlight)
library(ggtext)
library(sysfonts)
library(showtext)
library(countrycode)
library(lubridate)
library(ggrepel)

set.seed(0408)


hotels <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-11/hotels.csv')

countries <- codelist_panel %>%
  select(country.name.en, iso3c, continent)

```

```{r data manipulation}
euro_hotels_ranked <- hotels %>%
  mutate(quarter = case_when(
    is.element(arrival_date_month, c("January", "February", "March")) ~ "Q1",
    is.element(arrival_date_month, c("April", "May", "June")) ~ "Q2",
    is.element(arrival_date_month, c("July", "August", "September")) ~ "Q3",
    is.element(arrival_date_month, c("October", "November", "December")) ~ "Q4"
  ),
        yr_qtr = paste0(arrival_date_year, ":", quarter) %>%
          yq()) %>%
  count(country, arrival_date_year, quarter, yr_qtr, sort = TRUE) %>%
  left_join(countries, by = c("country" = "iso3c")) %>%
  filter(continent == "Europe") %>%
  distinct(country, yr_qtr, n, .keep_all = TRUE) %>%
  add_count(country, name = "cnt") %>%
  filter(cnt == 9) %>%
  group_by(yr_qtr) %>%
  mutate(rank = row_number(desc(n))) %>%
  ungroup()
  
```


```{r plot}
euro_hotels_ranked %>%
  group_by(country) %>%
  mutate(sd_rank = sd(rank)) %>%
  ungroup() %>%
  ggplot(aes(x = yr_qtr, y = rank, color = country.name.en)) +
  geom_point() + 
  geom_line() +
  geom_text(data = euro_hotels_ranked %>%
                    filter(yr_qtr == "2015-07-01"), aes(label = country.name.en),
            hjust = 1.1,
            color = "grey") +
  scale_y_reverse() +
  expand_limits(x = as.Date(c("2015-01-01", "2017-07-01"))) +
  gghighlight(is.element(sd_rank, range(sd_rank)), use_direct_label = TRUE) +
  theme_minimal()
```

